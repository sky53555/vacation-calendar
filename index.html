
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>연차 관리 캘린더</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.22.5/babel.min.js"></script>
</head>
<body class="bg-gray-50">
    <div id="root"></div>
    <script type="text/babel">
        function VacationCalendar() {
            const currentDate = new Date();
            const currentYear = currentDate.getFullYear();
            const currentMonth = currentDate.getMonth();

            const [month, setMonth] = React.useState(currentMonth);
            const [year, setYear] = React.useState(currentYear);
            const [totalVacation, setTotalVacation] = React.useState(15);
            const [vacationDays, setVacationDays] = React.useState({});
            const [memos, setMemos] = React.useState({});
            const [holidays, setHolidays] = React.useState([
                {date: '2025-01-01', name: '신정'},
                {date: '2025-01-29', name: '설날'},
                {date: '2025-01-30', name: '설날'},
                {date: '2025-01-31', name: '설날'},
                {date: '2025-03-01', name: '삼일절'},
                {date: '2025-05-05', name: '어린이날'},
                {date: '2025-05-08', name: '부처님 오신 날'},
                {date: '2025-06-03', name: '대통령 선거'},
                {date: '2025-06-06', name: '현충일'},
                {date: '2025-08-15', name: '광복절'},
                {date: '2025-09-16', name: '추석'},
                {date: '2025-09-17', name: '추석'},
                {date: '2025-09-18', name: '추석'},
                {date: '2025-10-03', name: '개천절'},
                {date: '2025-10-09', name: '한글날'},
                {date: '2025-12-25', name: '크리스마스'}
            ]);
            const [selectedDay, setSelectedDay] = React.useState(null);
            const [isModalOpen, setIsModalOpen] = React.useState(false);
            const [modalDate, setModalDate] = React.useState('');

            const prevMonth = () => {
                if (month === 0) {
                    setMonth(11);
                    setYear(year - 1);
                } else {
                    setMonth(month - 1);
                }
            };

            const nextMonth = () => {
                if (month === 11) {
                    setMonth(0);
                    setYear(year + 1);
                } else {
                    setMonth(month + 1);
                }
            };

            const selectDate = (day) => {
                const dateStr = `${year}-${(month + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                setSelectedDay(day);
                setModalDate(dateStr);
                setIsModalOpen(true);
            };

            const setVacationInfo = (type) => {
                const newVacationDays = { ...vacationDays };
                if (type === '0') {
                    delete newVacationDays[modalDate];
                } else {
                    newVacationDays[modalDate] = parseFloat(type);
                }
                setVacationDays(newVacationDays);
            };

            const usedVacation = Object.values(vacationDays).reduce((sum, value) => sum + value, 0);

            React.useEffect(() => {
                localStorage.setItem('vacationDays', JSON.stringify(vacationDays));
                localStorage.setItem('memos', JSON.stringify(memos));
                localStorage.setItem('totalVacation', totalVacation.toString());
            }, [vacationDays, memos, totalVacation]);

            React.useEffect(() => {
                const savedVacationDays = localStorage.getItem('vacationDays');
                const savedMemos = localStorage.getItem('memos');
                const savedTotalVacation = localStorage.getItem('totalVacation');
                if (savedVacationDays) setVacationDays(JSON.parse(savedVacationDays));
                if (savedMemos) setMemos(JSON.parse(savedMemos));
                if (savedTotalVacation) setTotalVacation(parseFloat(savedTotalVacation));
            }, []);

            const renderCalendar = () => {
                const monthNames = ['1월','2월','3월','4월','5월','6월','7월','8월','9월','10월','11월','12월'];
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const firstDay = new Date(year, month, 1).getDay();

                const days = [];
                for (let i = 0; i < firstDay; i++) {
                    days.push(<div key={`empty-${i}`} className="p-2 text-center text-gray-300"></div>);
                }

                for (let day = 1; day <= daysInMonth; day++) {
                    const dateStr = `${year}-${(month + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                    const isWeekend = new Date(year, month, day).getDay() % 6 === 0;
                    const isHoliday = holidays.some(h => h.date === dateStr);
                    const vacation = vacationDays[dateStr];
                    const hasMemo = memos[dateStr];
                    const holiday = holidays.find(h => h.date === dateStr);

                    let dayClass = "p-2 text-center cursor-pointer ";
                    if (vacation === 1) dayClass += "bg-blue-500 text-white";
                    else if (vacation === 0.5) dayClass += "bg-blue-300 text-white";
                    else if (isHoliday) dayClass += "bg-red-100 text-red-600";
                    else if (isWeekend) dayClass += "text-red-600";
                    else dayClass += "hover:bg-gray-100";

                    days.push(
                        <div key={day} className={dayClass} onClick={() => selectDate(day)}>
                            <div>{day}</div>
                            {vacation && <div className="text-xs">{vacation === 0.5 ? '반차' : '연차'}</div>}
                            {isHoliday && <div className="text-xs">{holiday.name}</div>}
                            {hasMemo && <div className="text-xs truncate">{memos[dateStr]}</div>}
                        </div>
                    );
                }

                return (
                    <div className="mb-4">
                        <div className="flex justify-between items-center mb-4">
                            <button className="px-4 py-2 bg-blue-500 text-white rounded" onClick={prevMonth}>이전</button>
                            <h2 className="text-xl font-bold">{year}년 {monthNames[month]}</h2>
                            <button className="px-4 py-2 bg-blue-500 text-white rounded" onClick={nextMonth}>다음</button>
                        </div>
                        <div className="grid grid-cols-7 gap-1 mb-2 font-bold">
                            <div className="text-center text-red-600">일</div><div className="text-center">월</div><div className="text-center">화</div>
                            <div className="text-center">수</div><div className="text-center">목</div><div className="text-center">금</div>
                            <div className="text-center text-blue-600">토</div>
                        </div>
                        <div className="grid grid-cols-7 gap-1">{days}</div>
                    </div>
                );
            };

            const renderModal = () => {
                if (!isModalOpen) return null;
                const dateObj = new Date(modalDate);
                const formattedDate = `${dateObj.getFullYear()}년 ${dateObj.getMonth()+1}월 ${dateObj.getDate()}일`;
                const isWeekend = dateObj.getDay() % 6 === 0;
                const isHoliday = holidays.some(h => h.date === modalDate);
                const vacation = vacationDays[modalDate];

                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10">
                        <div className="bg-white p-6 rounded-lg shadow-lg max-w-md w-full">
                            <h3 className="text-xl font-bold mb-4">{formattedDate}</h3>
                            {isWeekend || isHoliday ? (
                                <div className="mb-4 text-red-600">
                                    {isWeekend ? '주말' : holidays.find(h => h.date === modalDate).name}은(는) 연차를 사용할 수 없습니다.
                                </div>
                            ) : (
                                <div className="mb-4">
                                    <div className="font-bold mb-2">연차 설정:</div>
                                    <div className="flex gap-2">
                                        <button className={`px-4 py-2 rounded ${vacation === 1 ? 'bg-blue-500 text-white' : 'bg-gray-200'}`} onClick={() => setVacationInfo('1')}>연차 (1일)</button>
                                        <button className={`px-4 py-2 rounded ${vacation === 0.5 ? 'bg-blue-500 text-white' : 'bg-gray-200'}`} onClick={() => setVacationInfo('0.5')}>반차 (0.5일)</button>
                                        {vacation && <button className="px-4 py-2 bg-red-500 text-white rounded" onClick={() => setVacationInfo('0')}>취소</button>}
                                    </div>
                                </div>
                            )}
                            <div className="mb-4">
                                <div className="font-bold mb-2">메모:</div>
                                <textarea className="w-full p-2 border rounded" value={memos[modalDate] || ''}
                                    onChange={(e) => {
                                        const newMemos = { ...memos };
                                        if (e.target.value.trim()) newMemos[modalDate] = e.target.value;
                                        else delete newMemos[modalDate];
                                        setMemos(newMemos);
                                    }}
                                    placeholder="메모를 입력하세요..." rows="3" />
                            </div>
                            <div className="flex justify-end">
                                <button className="px-4 py-2 bg-gray-500 text-white rounded" onClick={() => setIsModalOpen(false)}>닫기</button>
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="container mx-auto p-4 max-w-2xl">
                    <h1 className="text-2xl font-bold mb-4">연차 관리 캘린더</h1>
                    <div className="mb-4 p-4 bg-blue-50 rounded">
                        <div className="flex justify-between mb-2">
                            <div>총 연차: <input type="number" value={totalVacation} onChange={(e) => setTotalVacation(parseFloat(e.target.value) || 0)} className="ml-2 w-16 p-1 border rounded text-center" /></div>
                            <div>사용한 연차: <span className="font-bold">{usedVacation}일</span></div>
                            <div>남은 연차: <span className="font-bold">{(totalVacation - usedVacation).toFixed(1)}일</span></div>
                        </div>
                        <div className="text-sm space-y-1">
                            <div>- 날짜를 클릭하여 연차/반차를 설정하고 메모를 남길 수 있습니다.</div>
                            <div>- 연차는 파란색, 반차는 연한 파란색으로 표시됩니다.</div>
                            <div>- 입력한 데이터는 브라우저에 자동 저장됩니다.</div>
                        </div>
                    </div>
                    {renderCalendar()}
                    {renderModal()}
                </div>
            );
        }
        ReactDOM.render(<VacationCalendar />, document.getElementById('root'));
    </script>
</body>
</html>
